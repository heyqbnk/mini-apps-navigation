"use strict";var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,o=0,e=arguments.length;o<e;o++)t+=arguments[o].length;var i=Array(t),a=0;for(o=0;o<e;o++)for(var r=arguments[o],n=0,s=r.length;n<s;n++,a++)i[a]=r[n];return i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BrowserNavigator=void 0;var Navigator_1=require("../Navigator"),utils_1=require("../utils"),utils_2=require("./utils"),BrowserNavigator=function(){function t(t){var o=this;void 0===t&&(t={}),this.originalPushState=window.history.pushState.bind(window.history),this.originalReplaceState=window.history.replaceState.bind(window.history),this.onPopState=function(t){if(utils_2.isBrowserState(t.state)){var e=t.state.navigator.locationIndex-o.navigator.locationIndex,i=o.navigator.go(e).delta-e;0!==i&&o.go(i)}else{var a=utils_1.parseSegue("default"===o.mode?window.location.pathname:window.location.hash);if(null===a)throw new Error("Unable to extract location from popstate event");o.navigator.pushLocation(a)}};var e=t.mode,i=void 0===e?"hash":e,a=t.log,r=void 0!==a&&a;this.navigator=new Navigator_1.Navigator(t),this.mode=i,this.logging=r}return t.prototype.createHistoryState=function(t){return void 0===t&&(t=null),{state:t,navigator:{locationIndex:this.navigator.locationIndex,locationsStack:this.navigator.locationsStack}}},t.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.logging&&console.log.apply(console,__spreadArrays(["%c[BrowserNavigator]:","font-weight: bold;"],t))},t.prototype.pushState=function(t,o,e){void 0===o&&(o={}),void 0===e&&(e=null);var i=this.navigator.pushLocation(t,o),a=i.location,r=i.delta;r>0?this.originalPushState(this.createHistoryState(e),"",this.createSegue(a)):r<0&&window.history.go(r)},t.prototype.replaceState=function(t,o,e){void 0===o&&(o={}),void 0===e&&(e=null),this.navigator.replaceLocation(t,o),this.originalReplaceState(this.createHistoryState(e),"",this.createSegue(t))},Object.defineProperty(t.prototype,"location",{get:function(){return this.navigator.getLocation()},enumerable:!1,configurable:!0}),t.prototype.pushLocation=function(t,o){void 0===o&&(o={}),this.pushState(t,o)},t.prototype.replaceLocation=function(t,o){void 0===o&&(o={}),this.replaceState(t,o)},t.prototype.mount=function(){var t=this;if(window.history.pushState=function(o,e,i){var a=utils_1.parseSegue(i||"");if(null===a)throw new Error("Unable to extract location from passed url to pushState");t.pushState(a)},window.history.replaceState=function(o,e,i){var a=utils_1.parseSegue(i||"");if(null===a)throw new Error("Unable to extract location from passed url to replaceState");t.replaceState(a)},window.addEventListener("popstate",this.onPopState),utils_2.isBrowserState(window.history.state)){this.log("Detected initial state while mounting:",window.history.state.navigator);var o=window.history.state.navigator,e=o.locationIndex,i=o.locationsStack;this.navigator.init(e,i)}else 1===window.history.length&&(this.log("Detected empty history. Replaced with root location"),this.replaceState({modifiers:["root"]}));this.log("Mount completed. Stack:",this.navigator.locationsStack,"Location:",this.location)},t.prototype.unmount=function(){window.removeEventListener("popstate",this.onPopState),window.history.pushState=this.originalPushState,window.history.replaceState=this.originalReplaceState},t.prototype.back=function(){window.history.back()},t.prototype.forward=function(){window.history.forward()},t.prototype.go=function(t){window.history.go(t)},t.prototype.on=function(t,o){this.navigator.on(t,o)},t.prototype.off=function(t,o){this.navigator.off(t,o)},t.prototype.createSegue=function(t){return("default"===this.mode?"":"#")+utils_1.createSegue(t)},t}();exports.BrowserNavigator=BrowserNavigator;