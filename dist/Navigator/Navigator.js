"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var o,i=1,e=arguments.length;i<e;i++)for(var n in o=arguments[i])Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}).apply(this,arguments)},__rest=this&&this.__rest||function(t,o){var i={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&o.indexOf(e)<0&&(i[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(e=Object.getOwnPropertySymbols(t);n<e.length;n++)o.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(i[e[n]]=t[e[n]])}return i},__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,o=0,i=arguments.length;o<i;o++)t+=arguments[o].length;var e=Array(t),n=0;for(o=0;o<i;o++)for(var s=arguments[o],r=0,a=s.length;r<a;r++,n++)e[n]=s[r];return e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Navigator=void 0;var utils_1=require("../utils"),Navigator=function(){function t(t){var o=this;void 0===t&&(t={}),this.listeners=[],this.locationsStack=[{modifiers:["root"]}],this.locationIndex=0,this.on=function(t,i){o.listeners.push({event:t,listener:i}),o.log("Added event listener:",t,i,o.listeners)},this.off=function(t,i){o.listeners=o.listeners.filter(function(o){return o.event!==t||o.listener!==i}),o.log("Removed event listener:",t,i,o.listeners)};var i=t.log,e=void 0!==i&&i;this.logging=e,this.log("Instance created")}return t.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.logging&&console.log.apply(console,__spreadArrays(["%c[Navigator]:","font-weight: bold;"],t))},t.prototype.emitLocationChanged=function(){var t=this.getLocation();this.listeners.forEach(function(o){var i=o.event,e=o.listener;"location-changed"===i&&e(t)}),this.log("Emitted location change:",t)},t.prototype.pushLocationToStack=function(t,o){void 0===o&&(o={}),this.locationIndex++,this.locationsStack=__spreadArrays(this.locationsStack.slice(0,this.locationIndex),[utils_1.formatLocation(t)]),this.log("Pushed location to stack. Location:",t,"Current stack:",this.locationsStack),o.silent||this.emitLocationChanged()},t.prototype.pushLocation=function(t,o){void 0===o&&(o={}),this.log("Pushing location:",t);var i=utils_1.formatLocation(t),e=i.modifiers,n=__rest(i,["modifiers"]);if(utils_1.isTechLocation(i)&&0===e.length)throw new Error("pushLocation received tech location with no specified modifiers");if(e.includes("back"))return this.log("This location has back modifier. Going back.."),this.back(o);if(e.includes("shadow")){this.log("This location has shadow modifier");var s=e.filter(function(t){return"shadow"!==t});this.pushLocationToStack(__assign(__assign({},n),{modifiers:__spreadArrays(s,["skip"])}))}else this.log("This location has no special modifiers"),this.pushLocationToStack(i,o);return{delta:1,location:this.getLocation()}},t.prototype.replaceLocation=function(t,o){void 0===o&&(o={}),this.log("Replacing location:",t);var i=utils_1.formatLocation(t);this.locationsStack[this.locationIndex]=i,o.silent||this.emitLocationChanged(),this.log("Replaced location",i)},t.prototype.go=function(t,o){void 0===o&&(o={}),this.log("go() called",t,o);var i=this.locationIndex,e=this.locationsStack,n=i+t;if(n<0?n=0:n>=e.length&&(n=e.length-1),n===i)return{delta:0,location:this.getLocation()};var s=t>0?"forward":"backward";if(e[n].modifiers.includes("skip")){var r=("forward"===s?__spreadArrays(e.slice(n+1),e.slice(i+1,n).reverse()):__spreadArrays(e.slice(0,n).reverse(),e.slice(n+1,this.locationIndex))).findIndex(function(t){return!t.modifiers.includes("skip")});n=-1===r?i:r}return n!==i?(this.locationIndex=n,o.silent||this.emitLocationChanged(),{delta:n-i,location:this.getLocation()}):{delta:0,location:this.getLocation()}},t.prototype.back=function(t){return void 0===t&&(t={}),this.log("back() called",t),this.go(-1,t)},t.prototype.forward=function(t){return void 0===t&&(t={}),this.log("forward() called",t),this.go(1,t)},t.prototype.init=function(t,o){if(t<0||o.length<=t)throw new Error("Invalid index was passed. It should be an index in locationsStack");this.locationIndex=t,this.locationsStack=o,this.log("Initialization complete, Arguments:",t,o)},t.prototype.getLocation=function(){return this.locationsStack[this.locationIndex]},t}();exports.Navigator=Navigator;